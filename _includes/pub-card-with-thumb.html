{% comment %}
  pub-card-with-thumb.html
  Card-style publication entry with optional thumbnail, venue/year,
  excerpt, citation and link to PDF.
{% endcomment %}

{% include base_path %}

{%- if post.header.teaser -%}
  {%- capture teaser -%}{{ post.header.teaser }}{%- endcapture -%}
{%- else -%}
  {%- assign teaser = site.teaser -%}
{%- endif -%}

{%- if post.id -%}
  {%- assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" -%}
{%- else -%}
  {%- assign title = post.title -%}
{%- endif -%}

<div class="pub-card">
  {%- if teaser -%}
  <div class="pub-thumb">
    <img
      src="{% if teaser contains '://' %}
              {{ teaser }}
            {% else %}
              {{ teaser | prepend: "/images/" | prepend: base_path }}
            {% endif %}"
      alt="Figure for {{ title | strip }}"
    >
  </div>
  {%- endif -%}

  <div class="pub-body">
    <!-- Title -->
    <h3 class="pub-title">
      {% if post.link %}
        <a href="{{ post.link }}">{{ title }}</a>
        <a href="{{ base_path }}{{ post.url }}" rel="permalink">
          <span class="sr-only">Permalink</span>
        </a>
      {% else %}
        <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
      {% endif %}
    </h3>

    <!-- Authors (optional) -->
    {% if post.authors %}
      <p class="pub-authors">{{ post.authors }}</p>
    {% endif %}

    <!-- Venue + year / type -->
    {% if post.collection == "teaching" %}
      <p class="pub-meta">
        {{ post.type }},
        <span class="pub-venue"><i>{{ post.venue }}</i></span>,
        <span class="pub-year">{{ post.date | default: "1900-01-01" | date: "%Y" }}</span>
      </p>
    {% elsif post.collection == "publications" %}
      <p class="pub-meta">
        Published in
        <span class="pub-venue"><i>{{ post.venue }}</i></span>,
        <span class="pub-year">{{ post.date | default: "1900-01-01" | date: "%Y" }}</span>
      </p>
    {% elsif post.date %}
      <p class="pub-meta">
        <strong>Published:</strong>
        <time datetime="{{ post.date | default: "1900-01-01" | date_to_xmlschema }}">
          {{ post.date | default: "1900-01-01" | date: "%B %d, %Y" }}
        </time>
      </p>
    {% endif %}

    <!-- Short description / abstract -->
    {% if post.excerpt and site.read_more != "enabled" %}
      <p class="pub-summary">
        {{ post.excerpt | markdownify | strip_newlines | remove: "<p>" | remove: "</p>" }}
      </p>
    {% elsif post.excerpt and site.read_more == "enabled" %}
      <p class="pub-summary">
        {{ post.excerpt | markdownify | strip_newlines | remove: "<p>" | remove: "</p>" }}
        <strong>
          <a href="{{ base_path }}{{ post.url }}" rel="permalink">Read more</a>
        </strong>
      </p>
    {% endif %}

    <!-- Citation / PDF link -->
    {% if post.citation or post.paperurl %}
      <p class="pub-extra">
        {% if post.citation and post.paperurl %}
          Recommended citation: {{ post.citation }}
          <a href="{{ post.paperurl }}"><u>{{ post.paperurl }}</u></a>
        {% elsif post.citation %}
          Recommended citation: {{ post.citation }}
        {% elsif post.paperurl %}
          Download <a href="{{ post.paperurl }}"><u>here</u></a>
        {% endif %}
      </p>
    {% endif %}
  </div>
</div>
